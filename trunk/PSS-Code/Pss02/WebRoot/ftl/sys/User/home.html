<script type="text/javascript">
var jsonStore = new dojo.data.ItemFileReadStore({  
    url: '${request.getContextPath()}/sys/User/initQuery',
    urlPreventCache : true,
    clearOnClose : true
}); 
</script>

<div dojoType="dijit.Toolbar">
	<button dojoType="dijit.form.Button"
		onClick="Common.showDialog('新建用户','/Pss/sys/User_add')">新建</button>
	<button dojoType="dijit.form.Button"
		onClick="update()">修改</button>
	<button dojoType="dijit.form.Button" onClick="remove()">删除</button>
</div>
<br />
<form id="searchForm">
<table align="center">
<tr>
    <th>用户名：</th>
    <td><input id="user.userName" name="user.userName"/></td>
    <th>角色：</th>
    <td><select name="user.role.roleId">
				<option value="0">
					店长
				</option>
				<option value="1">
					采购员
				</option>
				<option value="2">
					仓库管理员
				</option>
				<option value="3">
					销售员
				</option>
			</select>
	</td>
	<td>
	<button dojoType="dijit.form.Button"
		onClick="Common.submitFormAsync('searchForm',search)">查询</button>
	</td>
</tr>
</table>
</form>
<table id="jsonGrid" store="jsonStore" dojoType="dojox.grid.DataGrid"
	rowSelector="20px" height="80%">
	<thead>
		<tr>
			<th field="userName" width="auto">账号</th>
			<th field="role" formatter="roleValue" width="auto">角色</th>
			<th field="lastLoginTime" width="auto">最后登录时间</th>
		</tr>
	</thead>
</table>

<script type="text/javascript">
function search(){
    var query="";
}
function remove(){
	var ids = Common.getSelectedRows("jsonGrid", "userId");
	Common.confirm("确认要删除当前选择的用户吗?",doRemove,ids.toString());
}
function doRemove(data){
	var params = {deleteIds:data};
	Common.post('${request.getContextPath()}/sys/User/delete',params,afterRemove);
}
function afterRemove(data){
	if(data.correct){
		Common.refreshDataGrid("jsonGrid");
	}	
}
function update(){
  var id = Common.getSelectedRows("jsonGrid", "userId");
  var tenant = Common.getSelectedRows("jsonGrid", "tenant");
  Common.showDialog('修改用户','/Pss/sys/User_update?user.userId='+id+'&user.tenant='+tenant)
}
function roleValue(value, rowIndex){
	if(value.roleId==0){
		return "店主";
	}else{
		return "店员";
	}
}
</script>